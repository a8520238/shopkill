# shopkill

秒杀系统设计三部分
1. 基于dubbo,zookeeper的分布式架构
2. springsecurity+cas的登录，（待完善，权限部分较简单）
3. 秒杀系统：
- 抢单模块：多处用到redis，首先商品的id存入redis，代表商品，为了防止并发超卖。redis队列存储下单信息。为了防止重复抢单，redis存储自增键，判断是否只有一次。
- 下单模块：多线程处理redis队列中的数据，验证后，修改状态待支付，等待支付。这里为了防止并发同时下单，造成库存异常，库存数量也是一个自增键
- 支付模块：微信支付，成功回调时，删除抢单信息，持久化到数据库中
- 回滚模块：防止抢单后不付款占用资源，利用rabbitmq,将下单信息存入队列，一定时间后检测，redis中是否还有订单信息，如果有证明未支付，进行回滚